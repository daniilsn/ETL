# ETL Project
***
Данный проект является ETL-процессом. Загружается csv файл из облачного хранилища, затем данные обрабатываются, производится аналитика и в конце данные отправляются в Clickhouse. 

## Инструкция по запуску

### Собираем Docker-образы

Чтобы собрать и запустить Docker-образы, используйте команду:

```bash
docker-compose up --builder
```

Чтобы увидеть все запущенные контейнеры напишите:

```bash
docker ps
```

Для остановки работы Docker-контейнеров напишите:

```bash
docker-compose down
```

Для отдельного использования контейнера напишите:

```bash
docker exec -it <containerID> bash
```

## Сервисы

| Airflow | http://localhost:8080 | user: airflow | pass: airflow
| PostgreSQL | http://localhost:5432 | airflow | airflow         |
| ClickHouse | `Dbeaver host:localhost`  |  admin       |   admin       |
***

## Источник

Необработанные данные представляют собой исходные данные, которые будут использованы в ETL-процессе, и скачиваются в директорию raw_data.

## ClickHouse

Чтобы использовать ClickHouse, необходимо настроить соединение в Airflow GUI в разделе `Admin > Connections`, указав адрес сервера и учетные данные.

## Условия задания

### Подготовка данных
Необходимо загрузить файл данных в DataFrame PySpark, вывести количество строк и проверить корректность данных. Преобразовать поля в соответствующие типы данных. 

### Аналитика

Нужно вычислить средний и медианный год постройки зданий. Определить топ-10 областей и городов с наибольшим количеством объектов. Найти здания с максимальной и минимальной площадью в рамках каждой области. Определить количество зданий по десятилетиям (например, сколько зданий построено в 1950-х, 1960-х и т.д.).

### Загрузка данных в БД

Необходимо создать схему таблицы в ClickHouse, которая будет соответствовать структуре данных. Настроить соединение с ClickHouse из скрипта, это сделать необходимо в airflow. Загрузить обработанные данные из DataFrame в таблицу в ClickHouse.  Выполнить SQL скрипт в Python, который выведет топ 25 домов, у которых площадь больше 60 кв.м
